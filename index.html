<html>

<head>
<!--
	the style is based on the simple example found on w3schools.com:

		https://www.w3schools.com/howto/howto_css_calendar.asp

	internal CSS is used for conveience of the user being able to download
	a single file and open it and "just work"

	if you want to override the style, copy paste this out to style .css and
	add the following line here, and comment out the style element

		<link rel="stylesheet" href="style.css">

	-->
<style>
ul
{
	list-style-type: none;
	padding-inline-start: 0px;
	margin-block-start: 0em;
	margin-block-end: 0em;
	justify-content: center;
}

body
{
	font-family: Verdana, sans-serif;
	font-size: 1.25vw;
}

.title
{
	font-weight: bold;
	font-size: 135%;
}

.calendar-display
{
	width: 70%;
}

.sidebar
{
	width: 30%;
	height: 100%;
	position: fixed;
	top: 0;
	right: 0;
	padding-top: 40px;
	background-color: #ffffff;
}

.months
{
	background: #3adcbc;
	padding: 0% 2%;
	text-align: center;
}

.intercalary
{
	background: #3adcbc;
	padding: 0% 2%;
	text-align: center;
}

.intercalary li
{
	display: inline-block;
	padding: 0.5% 0.5%;
	margin: 1% 1%;
	width: 20%;
	color: #333;
	background: #1abc9c;
	text-align: center;
}

.months li
{
	display: inline-block;
	padding: 0.5% 0.5%;
	margin: 1% 1%;
	width: 21.5%;
	color: #333;
	background: #1abc9c;
	text-align: center;
}

.month-name
{
	font-weight: bold;
	font-size: 95%;
	text-align: center;
}

.month-season-name
{
	font-style: italic;
	text-align: center;
	font-size: 85%;
	padding: 0.3% 0%;
	margin-bottom:1.5%;
}

.month hr
{
	margin-bottom:1%;
	margin-top:0.5%;
}

.days
{
	background: #ffffff;
}

.days li
{
	display: inline-block;
	margin: 1% 1%;
	width:6.2%;
	color: #666;
	background: #ffffff;
	text-align: center;
	font-size: 67%;
}

.festival-date
{
	background: #6aeccc !important;
}

@media (max-aspect-ratio: 4/3)
{
	body
	{
		font-size: 1.75vw;
	}

	.title
	{
		font-size: 150%;
	}

	.months li
	{
		width:29.5%;
	}

	.month-name
	{
	}

	.month-season-name
	{
	}

	.days li
	{
		width:6.2%;
	}
}

@media (max-aspect-ratio: 1/1)
{
	body
	{
		font-size: 2.25vw;
	}

	.title
	{
		font-size: 200%;
	}

	.months li
	{
		width:46.5%;
	}

	.month-name
	{
	}

	.month-season-name
	{
	}

	.days li
	{
		width:6.2%;
	}

	.sidebar
	{
		width: 100%;
		height: 10%;
		padding-top: 40px;
		position: relative;
		background-color: #ffffff;
	}

	.calendar-display
	{
		width: 100%;
	}
}

</style>

</head>

<body>
<span class="title">Kemetic Festival Calendar</span>
<hr>
<div class="options">
	<label for="wep-ronpet">Wep Ronpet Date (Gregorian):</label>
	<input type="date" id="wep-ronpet" name="wep-ronpet">
	<button type="button" onclick='applyChanges();'>Apply</button>
</div>
<hr>
<div>
	<div class="calendar-display">
		<ul class="months">
			<li class="month">
				<div class="month-name">Tekhy</div>
				<hr>
				<div class="month-season-name">I Akhet</div>
				<ul class="days">
					<li class="day">1</li></ul></li></ul> <!-- single line
							to work around a bug in browser rendering or HTML
							or something else that made a whitespace break things
							-->
		<ul class="intercalary">
		</ul>
	</div>
	<div class="sidebar">
	TODO: Sidebar information when selecting a date
	</div>
</div>
<script>
// the idea is to dynamically generate the html based on the query string
// when we press the button we refresh the page with a new query string.

// this is not necessarily the best way to do this, but allows copy-pasting
// the address-bar without introducing multiple points of failure

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
let wepRonpetDate = new Date();
wepRonpetDate.setMonth(7);
wepRonpetDate.setDate(6);
if(urlParams.has('wep-ronpet'))
{
	wepRonpetDate = new Date(urlParams.get('wep-ronpet'));
}

// set the date in the picker
let datePicker = document.getElementById('wep-ronpet');
datePicker.value = wepRonpetDate.toISOString().substring(0, 10);

const seasonMonths =
[
	"I Akhet",
	"II Akhet",
	"III Akhet",
	"IV Akhet",
	"I Peret",
	"II Peret",
	"III Peret",
	"IV Peret",
	"I Shemu",
	"II Shemu",
	"III Shemu",
	"IV Shemu",
	"Intercalary"
];

const monthNames =
[
	"Tekhy",
	"Menhet",
	"Huwt-Her",
	"Ka Her Ka",
	"Sef Bedet",
	"Rekh-Wer",
	"Rekh-Nedes",
	"Renuwt",
	"Khonsu",
	"Henet Hetej",
	"Ipet Hemet",
	"Wep Ronpet",
	"Heryu Ronpet"
];

const festivalData = new Map(
[
	[1, "New Year - Opening of the Year - birthday of Ra-Horakhty (the sun-god)"],
	[15, "offerings to Hapy and Amun to secure a good flood (known from Dynasty 19 rock inscriptions at Gebel el-Silsila)"],
	[17, "eve of the Wag festival"],
	[18, "Wag festival"],
	[19, "Wag and Thoth festival, according to the great festival list in the temple for Ramesses III at Medinet Habu"],
	[20, "Tekh (drunkenness)"],
	[22, "Great Procession (of Osiris)"],
	
	[30 + 15, "start of Ipet festival as 11-day festivities for Amun in Luxor, according to the festival list of Thutmose III at Elephantine"],
	[30 + 18, "start of Ipet festival as 11-day festivities for Amun in Luxor, according to the festival list of Thutmose III at Elephantine"],
	[30 + 19, " start of Ipet festival as 27-day festivities for Amun in Luxor, according to the record of good deeds of Ramesses III (Papyrus Harris I), and great festival list in the temple for Ramesses III at Medinet Habu"],
	[30 + 27, "start of 2-day local festival of Mont, according to the late Middle Kingdom (about 2025-1700 BC) accounts papyrus Boulaq 18 (referring to it as 'festival of Mont'; this may be not an annual festival, but one ceremony, perhaps at the consecration of a shrine)"],
	[30 + 28, "local Elephantine festival of Satet and Anuqet, according to the festival list of Thutmose III at Elephantine"],
]);

let monthsContainer = document.getElementsByClassName("months")[0];

// find the first month, and the container for the days
let firstMonth = monthsContainer.getElementsByClassName("month")[0];
let firstMonthDaysContainer = firstMonth.getElementsByClassName("days")[0];

// find the first day
let firstDay = firstMonthDaysContainer.getElementsByClassName("day")[0];

// clone a copy for the intercalary days
let lastMonth = firstMonth.cloneNode(true);

// add the days
for(let i = 2; i <= 30; ++i)
{
	let clonedDay = firstDay.cloneNode(true);
	clonedDay.innerHTML = i.toString();
	firstMonthDaysContainer.appendChild(clonedDay);
}

// now clone the months
for(let i = 1; i < 12; ++i)
{
	let clonedMonth = firstMonth.cloneNode(true);
	let monthName = clonedMonth.getElementsByClassName("month-name")[0];
	let monthSeasonName =
		clonedMonth.getElementsByClassName("month-season-name")[0];
	monthSeasonName.innerHTML = seasonMonths[i];
	monthName.innerHTML = monthNames[i];
	monthsContainer.appendChild(clonedMonth);
}

// add the epogomeneal days...
let lastDaysContainer = lastMonth.getElementsByClassName("days")[0];
for(let i = 2; i <= 5; ++i)
{
	let clonedDay = firstDay.cloneNode(true);
	clonedDay.innerHTML = i.toString();
	lastDaysContainer.appendChild(clonedDay);
}

let intercalaryContainer = document.getElementsByClassName("intercalary")[0];
let monthName = lastMonth.getElementsByClassName("month-name")[0];
let monthSeasonName = lastMonth.getElementsByClassName("month-season-name")[0];
monthSeasonName.innerHTML = seasonMonths[12];
monthName.innerHTML = monthNames[12];
intercalaryContainer.appendChild(lastMonth);

// add onclick callbacks to each day, this relies on them being in order in
// the document
let allDays = document.getElementsByClassName("day");
let dayCounter = 1;
for (let day of allDays)
{
	const currentDay = dayCounter;
	if(festivalData.has(currentDay))
	{
		day.classList.add("festival-date");
	}
	day.onclick = function(){clickDay(currentDay);}
	++dayCounter;
}

function applyChanges()
{
	alert("TODO");
}

function clickDay(dayNumber)
{
	if(festivalData.has(dayNumber))
	{
		alert("Day " + dayNumber.toString() + " - " + festivalData.get(dayNumber));
	}
	else
	{
		alert("Day " + dayNumber.toString());
	}
}

</script>

</body>
</html>
